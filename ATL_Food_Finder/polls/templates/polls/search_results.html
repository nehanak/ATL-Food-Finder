<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Finder</title>

    <!-- Google Maps API with your API Key -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCoWkWdBmq8tvavjvyfFYhtNa3Y6mqCaO8&libraries=places,geometry&callback=initMap" ></script>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Global Styles */
body {
    font-family: 'Arial', sans-serif;
    background-color: #f4f4f9;
    color: #333;
}

h1 {
    text-align: center;
    padding: 20px 0;
    color: white;
    margin-top: 0;
    background-color: #2c3e50;
    font-size: 2.5rem;
    font-weight: 700;
}

#map {
    height: 700px; /* Increased height for a larger map */
    width: 100%;
}

.container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    max-width: 100%; /* Make container full width */
    margin: 0 auto;
    padding: 0 20px; /* Less padding to minimize white space */
}

/* Search Bar Styling */
.search-bar {
    background-color: white;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.1);
    width: 100%;
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
}

.search-bar form {
    display: grid;
    grid-template-columns: repeat(4, 1fr) 1fr;
    gap: 10px;
    align-items: center;
    width: 100%;
}

.search-bar label {
    font-weight: bold;
    color: #555;
    margin-bottom: 5px;
    text-align: left;
}

.search-bar select,
.search-bar input {
    padding: 10px;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 5px;
    width: 100%;
}

.search-bar button {
    padding: 10px;
    font-size: 1.2rem;
    background-color: #3498db;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    width: 100%;
}

.search-bar button:hover {
    background-color: #2980b9;
}

/* Restaurant and Map container layout */
.results-map-container {
    display: flex;
    width: 100%; /* Full width of the screen */
    justify-content: space-between;
    gap: 20px; /* Ensure space between map and restaurant list */
}

/* Map Styling */
#map {
    flex-grow: 1;
    height: 700px; /* Increased height for a larger map */
    width: 100%; /* Use full available width */
}

/* Restaurant List Styling */
#restaurant-list {
    width: 300px; /* Fixed width for the restaurant list */
    background-color: #fff;
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.1);
    overflow-y: auto;
    height: 700px; /* Match height with the map */
}

#restaurant-list h2 {
    margin-bottom: 15px;
    font-size: 1.5rem;
    color: #2c3e50;
}

.restaurant-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    margin-bottom: 10px;
}

.restaurant-item h3 {
    font-size: 1.2rem;
    margin-bottom: 5px;
}

.restaurant-item p {
    margin: 2px 0;
}

.restaurant-item:last-child {
    border-bottom: none;
}
.restaurant-item p {
    margin: 5px 0;
}


/* Media Queries for Mobile */
@media (max-width: 768px) {
    .search-bar form {
        grid-template-columns: 1fr;
    }

    .results-map-container {
        flex-direction: column;
    }

    #map {
        width: 100%;
        margin-bottom: 20px;
    }

    #restaurant-list {
        width: 100%;
    }
}

    </style>
</head>
<body>

    <h1>Find Restaurants Nearby</h1>

    <div class="container">
        <!-- Search Bar -->
        <div class="search-bar">
            <form id="restaurant-search-form">
                <div>
                    <label for="name">Restaurant Name: </label>
                    <input type="text" name="name" id="name" placeholder="Enter restaurant name">
                </div>
                <div>
                    <label for="cuisine">Cuisine: </label>
                    <select name="cuisine" id="cuisine">
                        <option value="">Any</option>
                        <option value="italian">Italian</option>
                        <option value="chinese">Chinese</option>
                        <option value="indian">Indian</option>
                        <option value="mexican">Mexican</option>
                        <option value="japanese">Japanese</option>
                    </select>
                </div>

                <div>
                    <label for="rating">Rating: </label>
                    <select name="rating" id="rating">
                        <option value="">Any</option>
                        <option value="4">4+</option>
                        <option value="3">3+</option>
                        <option value="2">2+</option>
                        <option value="1">1+</option>
                    </select>
                </div>

                <div>
                    <label for="price">Price Level: </label>
                    <select name="price" id="price">
                        <option value="">Any</option>
                        <option value="1">$</option>
                        <option value="2">$$</option>
                        <option value="3">$$$</option>
                        <option value="4">$$$$</option>
                    </select>
                </div>

                <div>
                    <label for="distance">Distance (miles): </label>
                    <input type="number" name="distance" id="distance" value="5">
                </div>

                <button type="submit">Search</button>
            </form>
        </div>

        <!-- Results and Map Container -->
        <div class="results-map-container">
            <!-- Map -->
            <div id="map"></div>

            <!-- Restaurant List -->
            <div id="restaurant-list">
                <h2>Restaurants</h2>
                <!-- Restaurant items will be dynamically added here -->
            </div>
        </div>
    </div>

    <script>
        let map;
        let service;
        let infoWindow;
        let markers = [];

        function initMap() {
            const atlanta = { lat: 33.7490, lng: -84.3880 };

            map = new google.maps.Map(document.getElementById("map"), {
                center: atlanta,
                zoom: 13,
            });

            infoWindow = new google.maps.InfoWindow();
            service = new google.maps.places.PlacesService(map);

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };
                        map.setCenter(userLocation);
                    },
                    () => {
                        map.setCenter(atlanta);
                    }
                );
            } else {
                map.setCenter(atlanta);
            }

            const form = document.getElementById('restaurant-search-form');
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const location = map.getCenter();
                searchRestaurants(location);
            });
        }

        function searchRestaurants(location) {
            const name = document.querySelector('#name').value.toLowerCase();
            const cuisine = document.querySelector('#cuisine').value;
            const rating = document.querySelector('#rating').value;
            const price = document.querySelector('#price').value;
            const distance = parseFloat(document.querySelector('#distance').value);

            const restaurantList = document.getElementById('restaurant-list');

            const request = {
                location: location,
                radius: Math.min(distance * 1609.34, 50000), // Use input distance, but cap at 50km (API limit)
                type: ['restaurant'],
                ...(cuisine && { keyword: cuisine })
            };

            service.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    clearMarkers();
                    clearRestaurantList();

                    const filteredResults = results.filter(place => {
                        let match = true;

                        // Calculate actual distance
                        const placeLocation = place.geometry.location;
                        const actualDistance = google.maps.geometry.spherical.computeDistanceBetween(location, placeLocation) / 1609.34; // Convert meters to miles

                        // Check if within specified distance
                        if (actualDistance > distance) {
                            return false;
                        }
                         // Filter by name
                         if (name && !place.name.toLowerCase().includes(name)) {
                            return false;
                        }

                        if (rating && place.rating !== undefined) {
                            match = match && (place.rating >= parseFloat(rating));
                        }

                        if (price && place.price_level !== undefined) {
                            match = match && (place.price_level <= parseInt(price));
                        }

                        return match;
                    });

                    if (filteredResults.length === 0) {
                        restaurantList.innerHTML = '<h2>Restaurants</h2><p class="message">No restaurants found matching your criteria. Try adjusting your filters.</p>';
                    } else {
                        restaurantList.innerHTML = '<h2>Restaurants</h2>';
                        filteredResults.forEach(place => {
                            const marker = createMarker(place);
                            addRestaurantToList(place, marker);
                        });
                    }
                } else {
                    restaurantList.innerHTML = '<h2>Restaurants</h2><p class="message">Error searching for restaurants. Please try again.</p>';
                }
            });
        }


        function createMarker(place) {
            const marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location,
            });

            google.maps.event.addListener(marker, 'click', () => {
                const detailsRequest = {
                    placeId: place.place_id,
                    fields: ['name', 'formatted_address', 'international_phone_number', 'formatted_phone_number', 'opening_hours', 'photos', 'rating', 'reviews', 'website', 'types']
                };

                const service = new google.maps.places.PlacesService(map);
                service.getDetails(detailsRequest, (placeDetails, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        const cuisineTypes = placeDetails.types.find(type => type.includes('_restaurant')) || placeDetails.types[0];

                        // Reviews content to be toggled
                        const reviewsContent = placeDetails.reviews ? placeDetails.reviews.slice(0, 3).map(review => `
                            <li><strong>${review.author_name}</strong>: ${review.text} <em>(Rating: ${review.rating})</em></li>
                        `).join('') : '<li>No reviews available.</li>';

                        const content = `
                            <div style="max-width: 300px; overflow-wrap: break-word;">
                                ${placeDetails.photos ? `<img src="${placeDetails.photos[0].getUrl()}" alt="${placeDetails.name}" style="width: 100%; max-height: 200px; object-fit: cover;">` : ''}
                                <h3>${placeDetails.name}</h3>
                                <p><strong>Address:</strong> ${placeDetails.formatted_address}</p>
                                <p><strong>Phone:</strong> ${placeDetails.international_phone_number || placeDetails.formatted_phone_number || 'N/A'}</p>
                                <p><strong>Rating:</strong> ${placeDetails.rating || 'N/A'} ⭐</p>
                                <p><strong>Cuisine Type:</strong> ${cuisineTypes}</p>
                                <p><strong>Website:</strong> <a href="${placeDetails.website}" target="_blank">${placeDetails.website || 'N/A'}</a></p>
                                <button id="toggle-reviews-btn" style="background-color: #007BFF; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">View Reviews</button>
                                <ul id="reviews-list" style="display: none; margin-top: 10px;">
                                    ${reviewsContent}
                                </ul>
                            </div>
                        `;

                        infoWindow.setContent(content);
                        infoWindow.open(map, marker);

                        // Wait for the DOM to be fully rendered before adding event listeners
                        google.maps.event.addListenerOnce(infoWindow, 'domready', () => {
                            const toggleReviewsBtn = document.getElementById('toggle-reviews-btn');
                            const reviewsList = document.getElementById('reviews-list');

                            toggleReviewsBtn.addEventListener('mouseover', () => {
                                toggleReviewsBtn.style.backgroundColor = '#0056b3'; // Darker blue on hover
                            });

                            toggleReviewsBtn.addEventListener('mouseout', () => {
                                toggleReviewsBtn.style.backgroundColor = '#007BFF'; // Original blue color
                            });

                            toggleReviewsBtn.addEventListener('click', () => {
                                if (reviewsList.style.display === 'none') {
                                    reviewsList.style.display = 'block';
                                    toggleReviewsBtn.textContent = 'Hide Reviews';
                                } else {
                                    reviewsList.style.display = 'none';
                                    toggleReviewsBtn.textContent = 'View Reviews';
                                }
                            });
                        });

                        map.panTo(marker.getPosition());
                    }
                });
            });

            markers.push(marker);
            return marker;
        }

        function addRestaurantToList(place, marker) {
            const list = document.getElementById('restaurant-list');
            const item = document.createElement('div');
            item.classList.add('restaurant-item');

            const placeLocation = place.geometry.location;
            const distance = google.maps.geometry.spherical.computeDistanceBetween(map.getCenter(), placeLocation) / 1609.34; // Convert meters to miles

            const restaurantName = document.createElement('h3');
            restaurantName.textContent = place.name;
            restaurantName.style.cursor = 'pointer';
            restaurantName.style.color = '#3498db';
            restaurantName.addEventListener('click', () => {
                google.maps.event.trigger(marker, 'click');
                map.panTo(marker.getPosition());
            });

            restaurantName.addEventListener('mouseover', () => {
                restaurantName.style.textDecoration = 'underline';
            });
            restaurantName.addEventListener('mouseout', () => {
                restaurantName.style.textDecoration = 'none';
            });

            item.appendChild(restaurantName);

            const details = document.createElement('div');
            details.innerHTML = `
                <p>Address: ${place.vicinity}</p>
                <p>Rating: ${place.rating || 'N/A'} ⭐</p>
                <p>Price Level: ${'$'.repeat(place.price_level || 0)}</p>
                <p>Distance: ${distance.toFixed(2)} miles</p>
            `;

            item.appendChild(details);
            list.appendChild(item);
        }

        function clearMarkers() {
            markers.forEach(marker => marker.setMap(null));
            markers = [];
        }

        function clearRestaurantList() {
            const list = document.getElementById('restaurant-list');
            list.innerHTML = '<h2>Restaurants</h2><p class="message info">Please apply at least one filter to search for restaurants.</p>';
        }
    </script>
</body>
</html>

